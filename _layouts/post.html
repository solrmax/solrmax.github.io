---
layout: blog
---

<article class="post">
  <header class="post-header">
    <h1 class="post-title">{{ page.title }}</h1>

    <div class="post-meta-line post-meta-line-top">
      {% if page.categories and page.categories != empty %}
        <span class="post-meta-categories">
          [
          {% for category in page.categories %}
            <a href="{{ '/blog/categories' | relative_url }}#category-{{ category | slugify }}" class="post-meta-link">{{ category }}</a>{% unless forloop.last %}, {% endunless %}
          {% endfor %}
          ]
        </span>
      {% endif %}

      {% if page.tags and page.tags != empty %}
        {% if page.categories and page.categories != empty %}
          <span class="post-meta-separator"> | </span>
        {% endif %}
        <span class="post-meta-tags">
          {% for tag in page.tags %}
            <a href="{{ '/blog/tags' | relative_url }}#tag-{{ tag | slugify }}" class="post-meta-link">{{ tag }}</a>{% unless forloop.last %}, {% endunless %}
          {% endfor %}
        </span>
      {% endif %}
    </div>

    <div class="post-meta-line post-meta-line-middle">
      <span class="post-meta-date">
        <a href="{{ '/blog/archive' | relative_url }}#archive-{{ page.date | date: '%Y-%m' }}" class="post-meta-link">{{ page.date | date: "%B %-d, %Y" }}</a>
      </span>
      <span class="post-meta-separator"> | </span>
      <span class="post-meta-author">
        {{ page.author | default: site.author.name }}
      </span>
    </div>

    <div class="post-meta-line post-meta-line-bottom">
      {% assign words = content | strip_html | number_of_words %}
        {% assign minutes = words | divided_by: 200 %}
        {% if minutes == 0 %}
          {% assign minutes = 1 %}
        {% endif %}
      <span class="post-meta-reading">
        {{ minutes }} min read
      </span>
    </div>
  </header>

  <section class="post-content">
    {{ content }}
  </section>

  {%- comment -%} Related posts by tags (max 3) {%- endcomment -%}
  {% assign related_limit  = 3 %}
  {% assign related_urls   = "" %}
  {% assign related_count  = 0 %}

  {% if page.tags and page.tags != empty %}
    {%- comment -%}
      First pass: try to get at most one post per tag (for variety)
    {%- endcomment -%}
    {% for tag in page.tags %}
      {% for post in site.posts %}
        {% if post.url != page.url and post.tags contains tag %}
          {% unless related_urls contains post.url %}
            {% assign related_urls = related_urls | append: post.url | append: "|" %}
            {% assign related_count = related_count | plus: 1 %}
            {% break %}
          {% endunless %}
        {% endif %}
      {% endfor %}
      {% if related_count >= related_limit %}
        {% break %}
      {% endif %}
    {% endfor %}

    {%- comment -%}
      Second pass: if we still have fewer than 3, fill with more posts
      that share any of the same tags (no duplicates).
    {%- endcomment -%}
    {% if related_count < related_limit %}
      {% for post in site.posts %}
        {% if post.url == page.url %}
          {% continue %}
        {% endif %}

        {% if related_urls contains post.url %}
          {% continue %}
        {% endif %}

        {% assign shares_tag = false %}
        {% for tag in page.tags %}
          {% if post.tags contains tag %}
            {% assign shares_tag = true %}
          {% endif %}
        {% endfor %}

        {% unless shares_tag %}
          {% continue %}
        {% endunless %}

        {% assign related_urls = related_urls | append: post.url | append: "|" %}
        {% assign related_count = related_count | plus: 1 %}

        {% if related_count >= related_limit %}
          {% break %}
        {% endif %}
      {% endfor %}
    {% endif %}
  {% endif %}

  {% if related_count > 0 %}
    <section class="post-related">
      <h2 class="post-related-title">Related Posts</h2>
      <ul class="post-related-list">
        {% assign related_array = related_urls | split: "|" %}

        {% for url in related_array %}
          {% if url == "" %}
            {% continue %}
          {% endif %}

          {% for post in site.posts %}
            {% if post.url == url %}

              {%- comment -%}
                Find a shared tag to display as "in Tag X"
              {%- endcomment -%}
              {% assign shared_tag = "" %}
              {% if page.tags and post.tags %}
                {% for tag in post.tags %}
                  {% if page.tags contains tag %}
                    {% assign shared_tag = tag %}
                    {% break %}
                  {% endif %}
                {% endfor %}
              {% endif %}

              <li class="post-related-item">
                <a class="post-related-link" href="{{ post.url | relative_url }}">{{ post.title }}</a>
                <div class="post-related-meta">
                  {{ post.date | date: "%B %-d, %Y" }}
                  {% if shared_tag != "" %}
                    &nbsp;·&nbsp; in "{{ shared_tag }}"
                  {% endif %}
                </div>
              </li>

              {% break %}
            {% endif %}
          {% endfor %}
        {% endfor %}
      </ul>
    </section>
  {% endif %}

  {% if page.previous or page.next %}
    <section class="post-nav-wrapper" aria-label="Post navigation">
      <nav class="post-nav">
        {% if page.previous %}
          <div class="post-nav-block post-nav-prev">
            <a class="post-nav-arrow" href="{{ page.previous.url | relative_url }}" >← Previous</a>
            <a
              class="post-nav-title"
              href="{{ page.previous.url | relative_url }}"
            >{{ page.previous.title }}</a>
          </div>
        {% endif %}

        {% if page.previous and page.next %}
          <div class="post-nav-divider"></div>
        {% endif %}

        {% if page.next %}
          <div class="post-nav-block post-nav-next">
            <a
              class="post-nav-arrow"
              href="{{ page.next.url | relative_url }}"
            >Next →</a>
            <a
              class="post-nav-title"
              href="{{ page.next.url | relative_url }}"
            >{{ page.next.title }}</a>
          </div>
        {% endif %}
      </nav>
    </section>
  {% endif %}

  <section class="post-comments">
      <h2 class="post-comments-title">Comments</h2>
      <div id="giscus_thread"></div>
      <script src="https://giscus.app/client.js"
              data-repo="Theby/theby.github.io"
              data-repo-id="R_kgDOQYKm0A"
              data-category="General"
              data-category-id="DIC_kwDOQYKm0M4CzeYc"
              data-mapping="url"
              data-strict="0"
              data-reactions-enabled="1"
              data-emit-metadata="1"
              data-input-position="top"
              data-theme="dark"
              data-lang="en"
              data-loading="lazy"
              crossorigin="anonymous"
              async>
      </script>
    </section>
</article>
